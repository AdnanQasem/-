{% extends "base.html" %}
{% load static %}

{% block title %}{{ project.title }} - سهمك{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/projects.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
{% endblock %}

{% block content %}
{# ====== هيدر تفاصيل المشروع ====== #}
<section id="head-details" class="head-details">
  <div class="container">
    <div class="details-heads">
      <!-- اسم المشروع -->
      <h2>{{ project.title }}</h2>

      <!-- فئة / قطاع المشروع لو موجود -->
      {% if project.category %}
        <span>{{ project.category }}</span>
      {% else %}
        <span>مشروع استثماري</span>
      {% endif %}

      <!-- وصف مختصر للمشروع -->
      <p>
        {{ project.short_description|default:project.description|truncatechars:260 }}
      </p>

      <!-- معلومات صاحب المشروع + التاريخ -->
      <div class="info-details">
        <!-- أيقونة صاحب المشروع -->
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
             viewBox="0 0 24 24" fill="none" stroke="currentColor"
             stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
             class="lucide lucide-users h-6 w-6 text-white">
          <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
          <circle cx="9" cy="7" r="4"></circle>
          <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
        </svg>
        <h3>صاحب المشروع: {{ project.owner.username }}</h3>

        <!-- أيقونة التاريخ -->
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
             viewBox="0 0 24 24" fill="none" stroke="currentColor"
             stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
             class="lucide lucide-calendar h-4 w-4">
          <path d="M8 2v4"></path>
          <path d="M16 2v4"></path>
          <rect width="18" height="18" x="3" y="4" rx="2"></rect>
          <path d="M3 10h18"></path>
        </svg>

        <h3>
          تاريخ الانتهاء:
          {% if project.end_date %}
            {{ project.end_date|date:"Y-m-d" }}
          {% else %}
            {{ project.created_at|date:"Y-m-d" }}
          {% endif %}
        </h3>
      </div>

    </div>
  </div>
</section>
<!-- end the info for sec head details -->


<!-- start the sec info project -->
<section id="project-details" class="project-details">
  <div class="container">
    <div class="info-projectdetails">

      <!-- العمود الأيمن (عن المشروع + التحديثات) -->
      <div class="r-info">

        <!-- right-1: عن المشروع -->
        <div class="right-1">
          <h2>عن المشروع</h2>

          <p>
            {{ project.description }}
          </p>

          <p class="p-r">
            {% if project.execution_note %}
              {{ project.execution_note }}
            {% else %}
              هذا المشروع يهدف إلى تقديم قيمة حقيقية للمجتمع المحلي من خلال توفير منتج أو خدمة مستدامة.
            {% endif %}
          </p>

          <!-- list (تقدر تربطها بحقول من المشروع لاحقاً) -->
          <ul>
            {% if project.feature_1 %}
              <li>{{ project.feature_1 }}</li>
            {% endif %}
            {% if project.feature_2 %}
              <li>{{ project.feature_2 }}</li>
            {% endif %}
            {% if project.feature_3 %}
              <li>{{ project.feature_3 }}</li>
            {% endif %}
            {% if project.feature_4 %}
              <li>{{ project.feature_4 }}</li>
            {% endif %}

            {# لو ما عندك حقول مخصصة، خليه ثابتين مؤقتاً #}
            {% if not project.feature_1 and not project.feature_2 and not project.feature_3 and not project.feature_4 %}
              <li>1- خط إنتاج أساسي للمشروع</li>
              <li>2- قسم خاص لتطوير وتحسين الخدمة</li>
              <li>3- فريق عمل مدرَّب ومؤهل</li>
              <li>4- خطة تسويق وتوزيع فعّالة</li>
            {% endif %}
          </ul>

          <h4>الخطة التنفيذية:</h4>

          <h5>
            {% if project.phase_one %}
              {{ project.phase_one }}
            {% else %}
              المرحلة الأولى (شهر 1-2): تجهيز الموقع وشراء المعدات
            {% endif %}
          </h5>

          <h5>
            {% if project.phase_two %}
              {{ project.phase_two }}
            {% else %}
              المرحلة الثانية (شهر 3): التدريب وبدء التشغيل التجريبي
            {% endif %}
          </h5>

          <h5>
            {% if project.phase_three %}
              {{ project.phase_three }}
            {% else %}
              المرحلة الثالثة (شهر 4 فما بعد): التشغيل الكامل والتوسع التدريجي
            {% endif %}
          </h5>
        </div>

        <!-- right-2: آخر التحديثات -->
        <div class="right-2">
          <h3>آخر التحديثات</h3>

          {# لو عندك موديل اسمه Update مربوط بالمشروع #}
          {% if project.updates.exists %}
            {% for update in project.updates.all %}
              <div class="updeta-project{% if not forloop.first %}" id="add-bor"{% endif %}">
                <h5>تحديث #{{ forloop.counter }}</h5>
                <h5 class="add-h5">
                  منذ {{ update.created_at|timesince }}
                </h5>
              </div>
              <div class="up">
                <h4>{{ update.title }}</h4>
                <p class="{% if forloop.first %}add-p{% endif %}">
                  {{ update.content }}
                </p>
              </div>
            {% endfor %}
          {% else %}
            <!-- لو ما في تحديثات -->
            <div class="up">
              <p>لا توجد تحديثات مضافة لهذا المشروع حتى الآن.</p>
            </div>
          {% endif %}
        </div>

      </div>

      <!-- العمود الأيسر (المعلومات المالية + التحذير) -->
      <div class="l-info">

        <!-- l-1: صندوق المساهمة -->
        <div class="l-1">
          <h3>ساهم في المشروع</h3>

          <div class="project-stats">
            <div class="stat">
              <span class="stat-label">المبلغ المطلوب</span>
              <span class="stat-value">
                {{ project.goal_amount }} ₪
              </span>
            </div>
            <div class="stat">
              <span class="stat-label">تم جمع:</span>
              <span class="stat-value">
                {{ project.raised_amount }} ₪
              </span>
            </div>
          </div>

          <div class="progress-section">
            <div class="progress-info">
              <span>العائد المتوقع:</span>
              <span>
                {% if project.expected_return %}
                  {{ project.expected_return }}% سنويًا
                {% else %}
                  سيتم تحديده حسب نوع المشروع
                {% endif %}
              </span>
            </div>
          </div>

          <div class="progress-bar">
            <div class="progress-fill" style="width:{{ project.progress }}%"></div>
          </div>

          <div class="progress-percent">
            {{ project.progress }}% من الهدف
          </div>

          <div class="l-detailsbox">
            <div class="box1">
              <h4>
                {% if project.min_investment %}
                  {{ project.min_investment }} ₪
                {% else %}
                  100 ₪
                {% endif %}
              </h4>
              <p>الحد الأدنى</p>
            </div>
            <div class="box2">
              <h4>
                {% if project.profit_ratio %}
                  {{ project.profit_ratio }}%
                {% else %}
                  25%
                {% endif %}
              </h4>
              <p>نسبة الربح</p>
            </div>
          </div>

          <div class="l-input">
            <form action="{% url 'projects:payment' project.id %}" method="get">
              <label for="amount">مبلغ المساهمة (₪)</label>
              <div>
                <input
                  id="amount"
                  name="amount"
                  type="number"
                  min="{{ project.min_investment|default:100 }}"
                  placeholder="الحد الأدنى {{ project.min_investment|default:100 }} ₪"
                  required
                >
              </div>
              <p>
                سوف تحصل على حصة تقديرية من الأرباح حسب مساهمتك.
              </p>

              <button type="submit">استثمر الآن</button>
              <p class="p-add">استثمار آمن ومتوافق شرعياً</p>
            </form>
          </div>
        </div>

        <!-- l-2: تحذير الاستثمار -->
        <div class="l-2">
          <h3>تحذير الاستثمار</h3>
          <p>
            الاستثمار في المشاريع ينطوى على مخاطر. قد تحصل على أرباح
            أو قد تخسر جزءاً من رأس المال. يرجى القراءة الجيدة قبل الاستثمار.
          </p>
        </div>

      </div>

    </div>
  </div>
</section>

{% endblock %}

