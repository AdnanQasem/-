{% extends "base.html" %}
{% load static %}

{% block title %}ملفي الشخصي - سهمي{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
    :root {
        --bg-page: #f3f6fc;
        --card-bg: #ffffff;
        --border-soft: #e1e7f5;
        --blue: #0d6efd;
        --blue-soft: #e4efff;
        --text-main: #1f2933;
        --text-muted: #6b7280;
        --radius-lg: 22px;
        --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.08);
    }

    .profile-page {
        padding: 130px 0 90px;
        background: radial-gradient(circle at top left, #e2ebff 0, #f3f6fc 40%, #f9fafb 100%);
        min-height: 100vh;
        font-family: "Tajawal", sans-serif;
    }

    .profile-shell {
        max-width: 1150px;
        margin: 0 auto;
        padding: 0 20px;
        display: grid;
        grid-template-columns: minmax(0, 320px) minmax(0, 1fr);
        gap: 28px;
        align-items: flex-start;
    }

    /* LEFT PANEL (USER CARD) */
    .profile-side {
        background: var(--card-bg);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-soft);
        padding: 32px 26px;
        border: 1px solid var(--border-soft);
        text-align: center;
    }

    .profile-avatar,
    .avatar-placeholder {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        object-fit: cover;
        margin: 0 auto 18px;
        border: 4px solid #ffffff;
        box-shadow: 0 10px 30px rgba(15, 23, 42, 0.18);
        background: #eef2ff;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 3.2rem;
        font-weight: 800;
        color: var(--blue);
    }

    .profile-name {
        font-size: 1.9rem;
        font-weight: 800;
        color: var(--text-main);
        margin-bottom: 4px;
    }

    .profile-email {
        font-size: 1.2rem;
        color: var(--text-muted);
        word-break: break-all;
        margin-bottom: 14px;
    }

    .role-chip {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 18px;
        border-radius: 999px;
        background: var(--blue-soft);
        color: var(--blue);
        font-size: 1.15rem;
        font-weight: 600;
        margin-bottom: 18px;
    }
    .role-chip i { font-size: 1.1rem; }

    .meta-list {
        margin-top: 10px;
        padding-top: 14px;
        border-top: 1px dashed var(--border-soft);
        text-align: start;
        font-size: 1.25rem;
        color: var(--text-muted);
    }
    .meta-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 7px 4px;
    }
    .meta-row span:first-child {
        color: var(--text-muted);
    }
    .meta-row span:last-child {
        font-weight: 600;
        color: var(--text-main);
    }

    .edit-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 12px 26px;
        margin-top: 20px;
        background: var(--blue);
        color: #fff;
        text-decoration: none;
        border-radius: 999px;
        font-size: 1.3rem;
        font-weight: 700;
        box-shadow: 0 14px 30px rgba(13,110,253,0.3);
        transition: 0.25s;
    }
    .edit-btn i { font-size: 1.2rem; }
    .edit-btn:hover {
        transform: translateY(-3px);
        background: #0b5ed7;
    }

    /* RIGHT SIDE (CONTENT) */
    .profile-main {
        display: flex;
        flex-direction: column;
        gap: 24px;
    }

    .card-block {
        background: var(--card-bg);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-soft);
        padding: 26px 28px 30px;
        border: 1px solid var(--border-soft);
    }

    .card-header {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        margin-bottom: 18px;
    }
    .card-title {
        font-size: 1.8rem;
        font-weight: 800;
        color: var(--text-main);
    }
    .card-subtitle {
        font-size: 1.2rem;
        color: var(--text-muted);
    }

    /* STATS GRID */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 18px;
        margin-top: 10px;
    }
    .stat-chip {
        border-radius: 18px;
        padding: 16px 18px;
        background: #f7f9fe;
        border: 1px solid #e2e8f0;
        display: flex;
        flex-direction: column;
        gap: 4px;
    }
    .stat-label {
        font-size: 1.2rem;
        color: var(--text-muted);
        display: flex;
        align-items: center;
        gap: 6px;
    }
    .stat-label i {
        font-size: 1.15rem;
        color: var(--blue);
    }
    .stat-value {
        font-size: 1.8rem;
        font-weight: 800;
        color: var(--text-main);
    }

    /* INFO LIST */
    .info-list {
        display: grid;
        grid-template-columns: 1fr;
        gap: 10px;
        margin-top: 10px;
    }
    .info-row {
        display: flex;
        align-items: center;
        gap: 14px;
        padding: 12px 10px;
        border-radius: 14px;
        background: #f8fafc;
    }
    .info-icon {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: var(--blue-soft);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--blue);
        font-size: 1.25rem;
    }
    .info-text {
        display: flex;
        flex-direction: column;
        gap: 2px;
    }
    .info-label {
        font-size: 1.2rem;
        color: var(--text-muted);
    }
    .info-value {
        font-size: 1.35rem;
        font-weight: 600;
        color: var(--text-main);
        word-break: break-word;
    }

    @media (max-width: 900px) {
        .profile-shell {
            grid-template-columns: minmax(0,1fr);
        }
    }
</style>
{% endblock %}

{% block content %}

<section class="profile-page">
    <div class="profile-shell">

        <!-- اللوحة الجانبية -->
        <aside class="profile-side">
            {% if user.profile.avatar %}
                <img src="{{ user.profile.avatar.url }}" alt="الصورة الشخصية" class="profile-avatar">
            {% else %}
                <div class="avatar-placeholder">
                    {{ user.username.0|upper }}
                </div>
            {% endif %}

            <div class="profile-name">
                {{ user.get_full_name|default:user.username }}
            </div>

            <div class="profile-email">
                {{ user.email }}
            </div>

            <div class="role-chip">
                <i class="fas fa-user-tie"></i>
                {% if user.profile.role == 'OWNER' %}
                    صاحب مشروع
                {% else %}
                    مستثمر
                {% endif %}
            </div>

            <div class="meta-list">
                <div class="meta-row">
                    <span>تاريخ الانضمام</span>
                    <span>{{ user.date_joined|date:"d M Y" }}</span>
                </div>
                <div class="meta-row">
                    <span>المشاريع</span>
                    <span>{{ user.projects_owned.count }}</span>
                </div>
                <div class="meta-row">
                    <span>الاستثمارات</span>
                    <span>{{ user.investments.count }}</span>
                </div>
            </div>

            <a href="{% url 'accounts:profile_edit' %}" class="edit-btn">
                <i class="fas fa-pen"></i>
                تعديل الملف الشخصي
            </a>
        </aside>

        <!-- المحتوى الرئيسي -->
        <main class="profile-main">

            <!-- كارت الإحصائيات -->
            <div class="card-block">
                <div class="card-header">
                    <div class="card-title">إحصائياتي</div>
                    <div class="card-subtitle">نظرة سريعة على نشاطك داخل المنصة</div>
                </div>

                <div class="stats-grid">
                    <div class="stat-chip">
                        <div class="stat-label">
                            <i class="fas fa-coins"></i>
                            الاستثمارات النشطة
                        </div>
                        <div class="stat-value">
                            {{ user.investments.count }}
                        </div>
                    </div>

                    <div class="stat-chip">
                        <div class="stat-label">
                            <i class="fas fa-chart-line"></i>
                            إجمالي الاستثمار
                        </div>
                        <div class="stat-value">
                            ₪{{ total_invested|default:"0" }}
                        </div>
                    </div>

                    <div class="stat-chip">
                        <div class="stat-label">
                            <i class="fas fa-trophy"></i>
                            مشاريع أطلقتها
                        </div>
                        <div class="stat-value">
                            {{ user.projects_owned.count }}
                        </div>
                    </div>

                    <div class="stat-chip">
                        <div class="stat-label">
                            <i class="fas fa-user-clock"></i>
                            مدة العضوية
                        </div>
                        <div class="stat-value">
                            {{ user.date_joined|date:"Y" }}
                        </div>
                    </div>
                </div>
            </div>

            <!-- كارت المعلومات الشخصية -->
            <div class="card-block">
                <div class="card-header">
                    <div class="card-title">معلوماتي الشخصية</div>
                    <div class="card-subtitle">بيانات يمكن تحديثها من صفحة تعديل الملف الشخصي</div>
                </div>

                <div class="info-list">
                    <div class="info-row">
                        <div class="info-icon">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="info-text">
                            <span class="info-label">الاسم الكامل</span>
                            <span class="info-value">
                                {{ user.get_full_name|default:"غير محدد" }}
                            </span>
                        </div>
                    </div>

                    <div class="info-row">
                        <div class="info-icon">
                            <i class="fas fa-envelope"></i>
                        </div>
                        <div class="info-text">
                            <span class="info-label">البريد الإلكتروني</span>
                            <span class="info-value">
                                {{ user.email }}
                            </span>
                        </div>
                    </div>

                    <div class="info-row">
                        <div class="info-icon">
                            <i class="fas fa-phone"></i>
                        </div>
                        <div class="info-text">
                            <span class="info-label">رقم الجوال</span>
                            <span class="info-value">
                                {{ user.profile.phone|default:"غير محدد" }}
                            </span>
                        </div>
                    </div>

                    <div class="info-row">
                        <div class="info-icon">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <div class="info-text">
                            <span class="info-label">المدينة</span>
                            <span class="info-value">
                                {{ user.profile.city|default:"غير محدد" }}
                            </span>
                        </div>
                    </div>
                </div>

            </div>

        </main>
    </div>
</section>

{% endblock %}
